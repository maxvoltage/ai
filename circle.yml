machine:
  environment:
    PATH: "$HOME/dependencies/erlang/bin:$HOME/dependencies/elixir/bin:$PATH"
    MIX_ENV: "test"
    ENV_AI_DB_URL: ecto://ubuntu:@localhost:5432/circle_test

checkout:
  pre:
    - git config --global user.email "circleci.com@mirai.audio"
    - git config --global user.name "Circle CI Build Bot"

dependencies:
  cache_directories:
  pre:
    - wget http://packages.erlang-solutions.com/erlang-solutions_1.0_all.deb && sudo dpkg -i erlang-solutions_1.0_all.deb
    - sudo apt-get update
    - sudo apt-get install esl-erlang
    - sudo apt-get install elixir
    - mix local.rebar --force
    - yes | mix deps.get
  override:
    - mix compile
    - MIX_ENV=test mix compile
    - MIX_ENV=prod mix compile
  cache_directories:
    - deps
    - _build

database:
  override:
    - mix ecto.create
    - mix ecto.migrate

test:
  override:
    - mix test
